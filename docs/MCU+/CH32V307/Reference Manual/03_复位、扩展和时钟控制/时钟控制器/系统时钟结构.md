---
sidebar_position: 1
description: 介绍CH32V307系统时钟
---

# 系统时钟结构

export const Highlight = ({children, color}) => (
  <span
    style={{
      backgroundColor: color,
      borderRadius: '2px',
      color: '#fff',
      padding: '0.2rem',
    }}>
    {children}
  </span>
);



RCC的全称为 Reset and Clock Control，复位和时钟控制器。关于CH32V307的复位系统，可查看[复位章节](/docs/MCU+/CH32V307/%E5%A4%8D%E4%BD%8D%E3%80%81%E6%89%A9%E5%B1%95%E5%92%8C%E6%97%B6%E9%92%9F%E6%8E%A7%E5%88%B6/%E5%A4%8D%E4%BD%8D)。

本章将详细介绍CH32V307的时钟结构，只有理解了整个系统的时钟结构，后面进行开发的时候才会得心应手。

CH32V307时钟树框图如下：

![ch32v307_sysytem_clock_tree](img\ch32v307_sysytem_clock_tree.png)

## 1. 高速时钟 HSE/HSI

### 1.1 HSE 外部高速时钟

High Speed External clock signal（HSE），外部高速时钟，可以由有源晶振或无源晶振提供，频率范围为<Highlight color="#25c2a0">3~25MHZ</Highlight> ，常用的为 8MHz 晶振。

- 当使用无源晶振时，时钟从 OSC_IN 和 OSC_OUT  引脚进入。

    通过设置 `RCC_CTLR` 寄存器中的 `HSEON` 位启动或关闭 HSE 晶振，`HSERDY` 位指示 HSE 晶体振荡是否稳定，稳定后才可将时钟送入系统。

![use_active_osc](img\HSE_use_passive_osc.png)

- 当使用高速时钟源（如有源晶振）时，需要设置 HSE 旁路。时钟直接从 OSC_IN 引脚进入，OSC_OUT 引脚**悬空**。

    需在 HSEON 位为 0 时，置 HSEBYP 位为1，打开 HSE 旁路功能，在将 HSEON 置1，开启 HSE 使能。

    ![use_active_osc](img\HSE_use_active_osc.png)

### 1.2 HSI 内部高速时钟

High Speed Inside clock signal（HSI），内部高速时钟，由系统内部 **8MHz** 的RC振荡器产生。

通过设置 `RCC_CTLR` 寄存器中的 `HSION` 位启动或关闭 HSI 晶振，`HSIRDY` 位指示 HSI 晶体振荡是否稳定，稳定后才可将时钟送入系统。

通常情况下，使用 HSI 起振时间短，但频率精度不如 HSE。

:::tip

- HSI出厂前都会校准，用户也可通过 `RCC_CTLR` 寄存器 `HSITRIM[4:0]` 位自行调整频率
- 如果 HSE 失效时，如果开启时钟安全系统（CSS），会自动切换 HSI 作为系统时钟，并可产生中断。

:::

## 2. 低速时钟

### 2.1 LSE 外部低速时钟

Low Speed External clock signal（LSE），外部低速时钟。LSE 可为 RTC 或者其他定时功能提供低功耗且精确的时钟源。

通过外接 32.768KHz 晶振。

通过设置 `RCC_BDCTLR` 寄存器中的 `LSEON` 位启动或关闭 LSE 晶振，`LSERDY` 位指示 LSE 晶体振荡是否稳定，稳定后才可将时钟送入系统。

- 使用无源晶振时，时钟从 OSC32_IN 和 OSC32_OUT  引脚进入。

    通过设置 `RCC_BDCTLR` 寄存器中的 `LSEON` 位启动或关闭 LSE 晶振，`LSERDY` 位指示 LSE 晶体振荡是否稳定，稳定后才可将时钟送入系统。

    ![use_active_osc](img\LSE_use_passive_osc.png)

- 使用低速时钟源（如有源晶振）时，需要设置 LSE 旁路。时钟直接从 OSC32_IN 引脚进入，OSC32_OUT 引脚**悬空**。

    需在 LSEON 位为 0 时，置 LSEBYP 位为1，打开 LSE 旁路功能，在将 LSEON 置1，开启 LSE 使能。

    ![use_active_osc](img\LSE_use_active_osc.png)

### 2.2 LSI 内部低速时钟

Low Speed Inside clock signal（LSI），内部低速时钟。LSI 由系统内部约 40KHz 的 RC 振荡器产生。

LSI 可以在停止和待机的模式下运行，为RTC、独立看门狗和唤醒单元提供时钟。

通过设置寄存器 `RCC_RSTSCKR` 中 `LSION` 位启动或关闭 LSI，查询 `LSIRDY` 位检测 LSI RC振荡是否稳定。



## 3. PLL

PLL时钟来源：









