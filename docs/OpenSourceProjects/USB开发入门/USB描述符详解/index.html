<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-OpenSourceProjects/USB开发入门/USB描述符详解">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">03_USB 描述符详解 | wch risc-v mcu wiki, unofficial</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wch.wiki/docs/OpenSourceProjects/USB开发入门/USB描述符详解"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="03_USB 描述符详解 | wch risc-v mcu wiki, unofficial"><meta data-rh="true" name="description" content="详细讲解 USB 5 种标准描述符"><meta data-rh="true" property="og:description" content="详细讲解 USB 5 种标准描述符"><link data-rh="true" rel="icon" href="/img/RISCV_MCU.png"><link data-rh="true" rel="canonical" href="https://wch.wiki/docs/OpenSourceProjects/USB开发入门/USB描述符详解"><link data-rh="true" rel="alternate" href="https://wch.wiki/docs/OpenSourceProjects/USB开发入门/USB描述符详解" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://wch.wiki/en/docs/OpenSourceProjects/USB开发入门/USB描述符详解" hreflang="en"><link data-rh="true" rel="alternate" href="https://wch.wiki/docs/OpenSourceProjects/USB开发入门/USB描述符详解" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="wch risc-v mcu wiki, unofficial RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="wch risc-v mcu wiki, unofficial Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b580904d.css">
<link rel="preload" href="/assets/js/runtime~main.dd3346b6.js" as="script">
<link rel="preload" href="/assets/js/main.b6126328.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/RISCV_MCU.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/RISCV_MCU.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">wch_wiki</b></a><a class="navbar__item navbar__link" href="/docs/RISCV/risc-v简介">RISC-V</a><a class="navbar__item navbar__link" href="/docs/MCU+/MCU+简介">MCU+</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/OpenSourceProjects/Open Source Projects简介">Open Source Projects</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/OpenSourceProjects/USB开发入门/USB描述符详解" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/OpenSourceProjects/USB开发入门/USB描述符详解" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="https://github.com/Taoyukai" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为暗黑模式）" aria-label="切换浅色/暗黑模式（当前为暗黑模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/OpenSourceProjects/Open Source Projects简介">RISC-V MCU 开源项目</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/risc-v-mcu原理与应用">RISC-V MCU原理与应用</a><button aria-label="打开/收起侧边栏菜单「RISC-V MCU原理与应用」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/手写一个risc-v-mcu-rtos">手写一个RISC-V MCU RTOS</a><button aria-label="打开/收起侧边栏菜单「手写一个RISC-V MCU RTOS」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/usb开发入门">USB开发入门</a><button aria-label="打开/收起侧边栏菜单「USB开发入门」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OpenSourceProjects/USB开发入门/USB简介">01_USB 简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OpenSourceProjects/USB开发入门/USB通信过程">02_USB 通信过程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/OpenSourceProjects/USB开发入门/USB描述符详解">03_USB 描述符详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OpenSourceProjects/USB开发入门/USB通信协议解析">04_USB 通信协议解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/OpenSourceProjects/USB开发入门/USB物理层电气信号">05_USB 物理层电气信号</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/demo_app">Demo_App</a><button aria-label="打开/收起侧边栏菜单「Demo_App」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/usb开发入门"><span itemprop="name">USB开发入门</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">03_USB 描述符详解</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>03_USB 描述符详解</h1><p>USB 协议为 USB 设备定义了一套描述设备功能和属性的有固定结构的描述符。</p><p>USB 设备通过描述符反映自己的设备特性。</p><p>USB 描述符是由特定格式排列的一组数据结构组成。</p><p>USB描述符包含标准描述符、类描述符和厂商自定义描述符３种形式。</p><p>5 种标准描述符：</p><ul><li><p>设备描述符（Device Descriptor)</p></li><li><p>配置描述符（Configuration Descriptor）</p></li><li><p>接口描述符（Interface Descriptor）</p></li><li><p>端点描述符（Endpoint Descriptor）</p></li><li><p>字符串描述符（String Descriptor）</p></li></ul><p><img loading="lazy" alt="usb_descriptor" src="/assets/images/usb_descriptor-cbaac96f3019a587d9023ba9513e88ca.png" width="897" height="451" class="img_ev3q"></p><p>详细描述见 USB_20 手册 9.6 章节。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-设备描述符device-descriptor">1. 设备描述符（Device Descriptor）<a class="hash-link" href="#1-设备描述符device-descriptor" title="标题的直接链接">​</a></h2><p>设备描述符是 USB 主机枚举 USB 设备申请的第 1 个描述符，用来表示这个 USB 设备有哪些特征。</p><p>每个 USB 设备有且仅有一个设备描述符。</p><p>设备描述符的长度为固定 18 字节。</p><table><thead><tr><th>偏移量</th><th>名称</th><th>大小/字节</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>bLength</td><td>1</td><td>描述符长度（18字节）</td></tr><tr><td>1</td><td>bDescriptorType</td><td>1</td><td>描述符类型（0x01）</td></tr><tr><td>2</td><td>bcdUSB</td><td>2</td><td>设备使用的 USB 协议版本</td></tr><tr><td>4</td><td>bDeviceClass</td><td>1</td><td>类代码</td></tr><tr><td>5</td><td>bDeviceSubClass</td><td>1</td><td>子类代码</td></tr><tr><td>6</td><td>bDeviceProtocol</td><td>1</td><td>设备使用的协议</td></tr><tr><td>7</td><td>bMaxPackeSize0</td><td>1</td><td>端点 0 最大包长（仅8，16，32，64合法）</td></tr><tr><td>8</td><td>idVender</td><td>2</td><td>厂商 ID</td></tr><tr><td>10</td><td>idProduct</td><td>2</td><td>产品 ID</td></tr><tr><td>12</td><td>bcdDevice</td><td>2</td><td>设备版本号</td></tr><tr><td>14</td><td>iManufacturer</td><td>1</td><td>描述厂商的字符串的索引</td></tr><tr><td>15</td><td>iProduct</td><td>1</td><td>描述产品的字符串的索引</td></tr><tr><td>16</td><td>iSerialNumber</td><td>1</td><td>产品序列号字符串的索引</td></tr><tr><td>17</td><td>bNumConfigurations</td><td>1</td><td>可能的配置数，一个USB可能有多个配置</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-blength">1.1 bLength<a class="hash-link" href="#11-blength" title="标题的直接链接">​</a></h3><p> 描述符长度（18字节，十六进制为0x12），就是标志描述符数据结构的长度。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-bdescriptortype">1.2 bDescriptorType<a class="hash-link" href="#12-bdescriptortype" title="标题的直接链接">​</a></h3><p>bDescriptorType代表了本描述符的类型，设备描述符为 0x01。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-bcdusb">1.3 bcdUSB<a class="hash-link" href="#13-bcdusb" title="标题的直接链接">​</a></h3><p>USB协议版本，表示形式0xJJMN版本JJ.M.N（JJ  - 主要版本号，M  - 次要版本号，N  - 次要版本）。</p><p> 如：USB2.0，写成：0x0200H；USB1.1，写成：0x0110 如果是USB3.11，写成：0x0311。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-bdeviceclassbdevicesubclassbdeviceprotocol">1.4 bDeviceClass、bDeviceSubClass、bDeviceProtocol<a class="hash-link" href="#14-bdeviceclassbdevicesubclassbdeviceprotocol" title="标题的直接链接">​</a></h3><p>bDeviceClass、bDeviceSubClass、bDeviceProtocol分别代表设备类型，子类型，设备使用的协议。</p><p>USB-IF区分设备类分了三个等级（类-子类-协议码）其中，类包含人机交互类、图像类、无线类、音频类等等；子类比如音频类的音频控制、音频流等等；协议比如人机接口类中的鼠标、键盘、触摸屏等。</p><p>详细 USB 设备类信息可到 <a href="https://www.usb.org/defined-class-codes" target="_blank" rel="noopener noreferrer">USB-IF 官网</a>查看。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-bmaxpackesize0">1.5 bMaxPackeSize0<a class="hash-link" href="#15-bmaxpackesize0" title="标题的直接链接">​</a></h3><p>端点 0 最大包长。</p><p>低速设备最大 8 字节。</p><p>全速和高速设备最大 64 字节。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="16-idvender">1.6 idVender<a class="hash-link" href="#16-idvender" title="标题的直接链接">​</a></h3><p> 厂商ID，就是个2字节的编号，由USB协议分配，厂商申请时需要交费</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="17-idproduct">1.7 idProduct<a class="hash-link" href="#17-idproduct" title="标题的直接链接">​</a></h3><p>产品ID，厂家自行定义。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="18-bcddevice">1.8 bcdDevice<a class="hash-link" href="#18-bcddevice" title="标题的直接链接">​</a></h3><p>产品版本号，厂家自行定义</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-配置描述符configuration-descriptor">2. 配置描述符（Configuration Descriptor）<a class="hash-link" href="#2-配置描述符configuration-descriptor" title="标题的直接链接">​</a></h2><p>一个USB设备至少有一个或者多个配置，具体配置数量由设备描述符 bNumConfigurations 决定。</p><p>每一种配置都对应一个<strong>配置描述符集合</strong>，包括标准配置描述符、接口描述符、端点描述符，如果是HID设备还会包括HID描述符。</p><p>一个标准的配置描述符组成如下：</p><table><thead><tr><th align="center">偏移量</th><th align="center">名称</th><th align="center">大小/字节</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">bLength</td><td align="center">1</td><td align="center">描述符长度，固定为 0x09</td></tr><tr><td align="center">1</td><td align="center">bDescriptorType</td><td align="center">1</td><td align="center">描述符类型，0x02</td></tr><tr><td align="center">2</td><td align="center">wTotalLength</td><td align="center">2</td><td align="center">配置描述符集合总长度</td></tr><tr><td align="center">4</td><td align="center">bNumInterfaces</td><td align="center">1</td><td align="center">配置支持的接口数</td></tr><tr><td align="center">5</td><td align="center">bConfigurationValue</td><td align="center">1</td><td align="center">该配置的值</td></tr><tr><td align="center">6</td><td align="center">iConfiguration</td><td align="center">1</td><td align="center">描述该配置的字符串的索引值</td></tr><tr><td align="center">7</td><td align="center">bmAttributes</td><td align="center">1</td><td align="center">该设备的属性</td></tr><tr><td align="center">9</td><td align="center">bMaxPower</td><td align="center">1</td><td align="center">设备所需的电流（单位为 2 mA）</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-wtotallength">2.1 wTotalLength<a class="hash-link" href="#21-wtotallength" title="标题的直接链接">​</a></h3><p>配置描述符集合总长度，该集合中可能包含多个接口和端点描述符，该值为这些描述符长度之和。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-bnuminterfaces">2.2 bNumInterfaces<a class="hash-link" href="#22-bnuminterfaces" title="标题的直接链接">​</a></h3><p>当前配置下的接口数量。</p><p>单一功能的设备只有一个接口，如键盘或者鼠标。</p><p>复合设备会有多个接口，如键鼠一体的复合设备。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-bconfigurationvalue">2.3 bConfigurationValue<a class="hash-link" href="#23-bconfigurationvalue" title="标题的直接链接">​</a></h3><p>一个设备可能有多个配置，该值支持当前配置的标号。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-iconfiguration">2.4 iConfiguration<a class="hash-link" href="#24-iconfiguration" title="标题的直接链接">​</a></h3><p>描述该配置的字符串的索引值，如果没有字符串，那该值为 0。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-bmattributes">2.5 bmAttributes<a class="hash-link" href="#25-bmattributes" title="标题的直接链接">​</a></h3><p>该设备的属性。</p><p>Bit4-0 保留。</p><p>Bit5 表示是否支持远程唤醒，为 1 表示支持，为 0 表示不支持。</p><p>Bit6 表示供电方式，为 1 表示总线供电，为 0 表示自供电。</p><p>Bit7 保留，默认设置为 1。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="26-bmaxpower">2.6 bMaxPower<a class="hash-link" href="#26-bmaxpower" title="标题的直接链接">​</a></h3><p>表示设备需要从总线获取的最大电流。单位为 2mA。</p><p>如需获得 100mA 的最大电流，则设置为 0x32。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-接口描述符interface-descriptor">3. 接口描述符（Interface Descriptor）<a class="hash-link" href="#3-接口描述符interface-descriptor" title="标题的直接链接">​</a></h2><p>接口描述符不能单独返回给USB主机，主机会请求获得配置描述符集合，接口描述符必须附在配置描述符后面。</p><p>标准的接口描述符组成如下：</p><table><thead><tr><th align="center">偏移量</th><th align="center">名称</th><th align="center">大小/字节</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">bLength</td><td align="center">1</td><td align="center">描述符长度，固定为 0x09</td></tr><tr><td align="center">1</td><td align="center">bDescriptorType</td><td align="center">1</td><td align="center">描述符类型，0x04</td></tr><tr><td align="center">2</td><td align="center">bInterfaceNumber</td><td align="center">1</td><td align="center">该接口的编号（从 0 开始）</td></tr><tr><td align="center">3</td><td align="center">bAlternateSetting</td><td align="center">1</td><td align="center">该接口的备用编号</td></tr><tr><td align="center">4</td><td align="center">bNumEndpoints</td><td align="center">1</td><td align="center">该接口所使用的端点数量</td></tr><tr><td align="center">5</td><td align="center">bInterfaceClass</td><td align="center">1</td><td align="center">该接口所使用的类</td></tr><tr><td align="center">6</td><td align="center">bInterfaceSubClass</td><td align="center">1</td><td align="center">该接口所使用的子类</td></tr><tr><td align="center">7</td><td align="center">bInterfaceProtocol</td><td align="center">1</td><td align="center">该接口所使用的协议</td></tr><tr><td align="center">8</td><td align="center">iConfiguration</td><td align="center">1</td><td align="center">描述该接口的字符串的索引值</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-binterfacenumber">3.1 bInterfaceNumber<a class="hash-link" href="#31-binterfacenumber" title="标题的直接链接">​</a></h3><p>表示该接口的编号。当一个配置有多个接口时，每个接口的编号都不相同。</p><p>从 0 开始依次递增对每个配置的接口进行编号。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-balternatesetting">3.2 bAlternateSetting<a class="hash-link" href="#32-balternatesetting" title="标题的直接链接">​</a></h3><p>该接口的备用编号，编号规则同 bInterfaceNumber。</p><p>很少使用，通常设置为 0。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-bnumendpoints">3.3 bNumEndpoints<a class="hash-link" href="#33-bnumendpoints" title="标题的直接链接">​</a></h3><p>表示该接口使用的端点数（不包括端点 0）。</p><p>如果为 0 ，则表示该接口不使用其他端点，只用默认的控制端点。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-binterfaceclassbinterfacesubclassbinterfaceprotocol">3.4 bInterfaceClass、bInterfaceSubClass、bInterfaceProtocol<a class="hash-link" href="#34-binterfaceclassbinterfacesubclassbinterfaceprotocol" title="标题的直接链接">​</a></h3><p>bInterfaceClass、bInterfaceSubClass、bInterfaceProtocol 分别为接口所使用的类、接口所使用的子类以及接口所使用的协议。</p><p>这些都由 USB-IF 规定。跟设备描述符中的意义类似。</p><p>通常在接口中定义设备的功能，而在设备描述符中讲类、子类、协议都设置为 0x00。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-iconfiguration">3.5 iConfiguration<a class="hash-link" href="#35-iconfiguration" title="标题的直接链接">​</a></h3><p>描述该接口的字符串索引值。如果为 0 则表示没有字符串描述符。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-端点描述符endpoint-descriptor">4. 端点描述符（Endpoint Descriptor）<a class="hash-link" href="#4-端点描述符endpoint-descriptor" title="标题的直接链接">​</a></h2><p>端点描述符不能单独返回给USB主机，主机会请求获得配置描述符集合，端点描述符必须附在配置描述符后面一并返回。</p><p>标准的端点描述符的组成如下：</p><table><thead><tr><th align="center">偏移量</th><th align="center">名称</th><th align="center">大小/字节</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">bLength</td><td align="center">1</td><td align="center">描述符长度，固定为 0x07</td></tr><tr><td align="center">1</td><td align="center">bDescriptorType</td><td align="center">1</td><td align="center">描述符类型，0x05</td></tr><tr><td align="center">2</td><td align="center">bEndpointAddress</td><td align="center">1</td><td align="center">该端点的地址</td></tr><tr><td align="center">3</td><td align="center">bmAttributes</td><td align="center">1</td><td align="center">该端点的属性</td></tr><tr><td align="center">4</td><td align="center">wMaxPackeSize</td><td align="center">2</td><td align="center">该端点支持的最大包长度</td></tr><tr><td align="center">6</td><td align="center">bInterval</td><td align="center">1</td><td align="center">该端点的查询时间</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-bendpointaddress">4.1 bEndpointAddress<a class="hash-link" href="#41-bendpointaddress" title="标题的直接链接">​</a></h3><p>Bit 3~0：端点号</p><p>Bit6~4：保留，设置为 0</p><p>Bit7：该端点的传输方向，1 为 Input，0 为 Output。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-bmattributes">4.2 bmAttributes<a class="hash-link" href="#42-bmattributes" title="标题的直接链接">​</a></h3><p>Bit1 ~ 0：传输类型</p><ul><li>00：Control 控制传输</li><li>01：Isochronous 同步传输</li><li>10：Bulk 批量传输</li><li>11：Interrupt 中断传输</li></ul><p>Bit7~2：</p><ul><li>如果该端点不是同步传输，则设置为 0</li><li>如果该端点为同步传输怎<ul><li>Bit3~2：表示同步的类型，00 为无同步，01 为异步，10 为适配，11 为同步</li><li>Bit5~4：表示用途，00为数据端点，01为反馈端点，10 为暗含反馈的数据端点，11为保留值</li><li>Bit7~6，保留。设置为00。</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-wmaxpackesize">4.3 wMaxPackeSize<a class="hash-link" href="#43-wmaxpackesize" title="标题的直接链接">​</a></h3><p>表示当前配置下此端点能够接收或发送的最大数据包的大小。</p><p>两个字节长度，低字节在前。</p><p>对于全速和低速模式，Bit10~0 表示端点的最大包长度，其他位保留位 0。</p><p>对于高速模式，Bit10~0 表示端点的最大包长度，Bit12~11 为每个帧附加的传输次数。其他位保留为 0 。</p><p>详细可参 USB2.0 协议第 5.9 章节。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-binterval">4.4 bInterval<a class="hash-link" href="#44-binterval" title="标题的直接链接">​</a></h3><p>查询时间，就是主机多久和设备通讯一次，主机在枚举设备的时候会得到端点描述符，然后根据端点描述符这个值和此端点进行对应的数据交互，也就是主机多久给端点发送一次数据请求。根据设备运行速度以帧或微帧表示，低速和全速称为帧，下面的一个值代表1ms，高速称为微帧，一个值代表125us。</p><p>对于全速/高速同步端点，此值必须在 1 到 16 之间。（bInterval-1）值用作2的指数，例如bInterval为 4，表示周期为 8 个单位；</p><p>对于全速/低速中断端点，该字段的值可以是1到255，也就是主机多少ms给设备发一次数据请求；</p><p>对于高速中断端点，使用（bInterval-1）值作为 2 的指数，例如bInterval为 4 表示周期为 8。这个值必须在 1 到 16 之间；</p><p>对于高速批量/控制输出端点，bInterval 必须指定端点的最大NAK速率。值 0 表示端点永不 NAK。其它值表示每个微帧的 bInterval*125us 时间最多 1 个NAK。这个值的范围必须在 0 到 255 之间。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-字符串描述符string-descriptor">5. 字符串描述符（String Descriptor）<a class="hash-link" href="#5-字符串描述符string-descriptor" title="标题的直接链接">​</a></h2><p>为了提供比较友好的设备标识，USB规范中定义了字符串描述符，即使用人类的自然语言来描述设备的功能，生产厂家，生产序列号等。</p><p>字符串描述符是可选的。如果不支持字符串描述符，其设备描述符、配置描述符、接口描述符内的所有字符串描述符索引都必须为０。</p><p>USB字符串统一使用 UNICODE 编码。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-语言-id-描述符">5.1 语言 ID 描述符<a class="hash-link" href="#51-语言-id-描述符" title="标题的直接链接">​</a></h3><p>语言 ID 描述符也是字符串描述符的一种，要添加字符串描述符必须要使用语言 ID 描述符告诉主机该设备支持哪些国家的语言。</p><p>语言 ID 描述符的索引值为 0。</p><p>语言 ID 描述符组成如下：</p><table><thead><tr><th align="center">偏移量</th><th align="center">名称</th><th align="center">大小/字节</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">bLength</td><td align="center">1</td><td align="center">描述符长度（不定），根据实际长度填写</td></tr><tr><td align="center">1</td><td align="center">bDescriptorType</td><td align="center">1</td><td align="center">描述符类型，0x03</td></tr><tr><td align="center">2</td><td align="center">wLANGID<!-- -->[0]</td><td align="center">2</td><td align="center">语言 ID 号 0</td></tr><tr><td align="center">...</td><td align="center">...</td><td align="center">...</td><td align="center">...</td></tr><tr><td align="center">2*n+2</td><td align="center">wLANGID<!-- -->[n]</td><td align="center">2</td><td align="center">语言 ID 号 n</td></tr></tbody></table><p>常用的语言ID ：</p><ul><li>中文 ID： 0x1404</li><li>US English ID：0x0409</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-字符串描述符">5.2 字符串描述符<a class="hash-link" href="#52-字符串描述符" title="标题的直接链接">​</a></h3><p>字符串描述符组成如下：</p><table><thead><tr><th align="center">偏移量</th><th align="center">名称</th><th align="center">大小/字节</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">bLength</td><td align="center">1</td><td align="center">描述符长度（不定），根据实际长度填写</td></tr><tr><td align="center">1</td><td align="center">bDescriptorType</td><td align="center">1</td><td align="center">描述符类型，0x03</td></tr><tr><td align="center">2</td><td align="center">bString</td><td align="center">不定</td><td align="center">UNICODE 编码的字符串</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a class="hash-link" href="#参考" title="标题的直接链接">​</a></h2><ul><li><a href="https://www.usb.org/sites/default/files/usb_20_20211008.zip" target="_blank" rel="noopener noreferrer">USB 2.0 Specification</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/OpenSourceProjects/USB开发入门/USB通信过程"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">02_USB 通信过程</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/OpenSourceProjects/USB开发入门/USB通信协议解析"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">04_USB 通信协议解析</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-设备描述符device-descriptor" class="table-of-contents__link toc-highlight">1. 设备描述符（Device Descriptor）</a><ul><li><a href="#11-blength" class="table-of-contents__link toc-highlight">1.1 bLength</a></li><li><a href="#12-bdescriptortype" class="table-of-contents__link toc-highlight">1.2 bDescriptorType</a></li><li><a href="#13-bcdusb" class="table-of-contents__link toc-highlight">1.3 bcdUSB</a></li><li><a href="#14-bdeviceclassbdevicesubclassbdeviceprotocol" class="table-of-contents__link toc-highlight">1.4 bDeviceClass、bDeviceSubClass、bDeviceProtocol</a></li><li><a href="#15-bmaxpackesize0" class="table-of-contents__link toc-highlight">1.5 bMaxPackeSize0</a></li><li><a href="#16-idvender" class="table-of-contents__link toc-highlight">1.6 idVender</a></li><li><a href="#17-idproduct" class="table-of-contents__link toc-highlight">1.7 idProduct</a></li><li><a href="#18-bcddevice" class="table-of-contents__link toc-highlight">1.8 bcdDevice</a></li></ul></li><li><a href="#2-配置描述符configuration-descriptor" class="table-of-contents__link toc-highlight">2. 配置描述符（Configuration Descriptor）</a><ul><li><a href="#21-wtotallength" class="table-of-contents__link toc-highlight">2.1 wTotalLength</a></li><li><a href="#22-bnuminterfaces" class="table-of-contents__link toc-highlight">2.2 bNumInterfaces</a></li><li><a href="#23-bconfigurationvalue" class="table-of-contents__link toc-highlight">2.3 bConfigurationValue</a></li><li><a href="#24-iconfiguration" class="table-of-contents__link toc-highlight">2.4 iConfiguration</a></li><li><a href="#25-bmattributes" class="table-of-contents__link toc-highlight">2.5 bmAttributes</a></li><li><a href="#26-bmaxpower" class="table-of-contents__link toc-highlight">2.6 bMaxPower</a></li></ul></li><li><a href="#3-接口描述符interface-descriptor" class="table-of-contents__link toc-highlight">3. 接口描述符（Interface Descriptor）</a><ul><li><a href="#31-binterfacenumber" class="table-of-contents__link toc-highlight">3.1 bInterfaceNumber</a></li><li><a href="#32-balternatesetting" class="table-of-contents__link toc-highlight">3.2 bAlternateSetting</a></li><li><a href="#33-bnumendpoints" class="table-of-contents__link toc-highlight">3.3 bNumEndpoints</a></li><li><a href="#34-binterfaceclassbinterfacesubclassbinterfaceprotocol" class="table-of-contents__link toc-highlight">3.4 bInterfaceClass、bInterfaceSubClass、bInterfaceProtocol</a></li><li><a href="#35-iconfiguration" class="table-of-contents__link toc-highlight">3.5 iConfiguration</a></li></ul></li><li><a href="#4-端点描述符endpoint-descriptor" class="table-of-contents__link toc-highlight">4. 端点描述符（Endpoint Descriptor）</a><ul><li><a href="#41-bendpointaddress" class="table-of-contents__link toc-highlight">4.1 bEndpointAddress</a></li><li><a href="#42-bmattributes" class="table-of-contents__link toc-highlight">4.2 bmAttributes</a></li><li><a href="#43-wmaxpackesize" class="table-of-contents__link toc-highlight">4.3 wMaxPackeSize</a></li><li><a href="#44-binterval" class="table-of-contents__link toc-highlight">4.4 bInterval</a></li></ul></li><li><a href="#5-字符串描述符string-descriptor" class="table-of-contents__link toc-highlight">5. 字符串描述符（String Descriptor）</a><ul><li><a href="#51-语言-id-描述符" class="table-of-contents__link toc-highlight">5.1 语言 ID 描述符</a></li><li><a href="#52-字符串描述符" class="table-of-contents__link toc-highlight">5.2 字符串描述符</a></li></ul></li><li><a href="#参考" class="table-of-contents__link toc-highlight">参考</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 taoyukai, Inc. Built with Docusaurus.<p><a href="http://beian.miit.gov.cn/" class="footer_lin">	苏ICP备17052473号-4</a></p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.dd3346b6.js"></script>
<script src="/assets/js/main.b6126328.js"></script>
</body>
</html>